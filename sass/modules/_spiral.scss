$shape-size: 300px;
$shape-x: 25px;
$shape-y: 60px;
$shape-z: 15px;

$total-items-count: 15;
$animation-timing: 22s;

#spiral-anim {
    min-height: 400px;
    
    perspective: 2000px;
    -webkit-perspective: 2000px;
    
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;

  .spiral-cnt {
      animation: spinY 15s linear infinite;
      -webkit-animation: spinY 15s linear infinite;

      height: $shape-size * 2;
      width: 100%;

      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;

      margin-top: 200px;
  }

  .shape {
      // opacity: 0;
      @include centerItem($shape-size/2, $shape-size); // w & h
      perspective: 2000px;
      -webkit-perspective: 2000px;

      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;

      transform-origin: right center;
      -webkit-transform-origin: right center;


      @for $itemcount from 1 through $total-items-count {
          &:nth-child(#{$itemcount}) {
              animation: spiral $animation-timing linear ($animation-timing / $total-items-count * $itemcount) infinite;
              -webkit-animation: spiral $animation-timing linear ($animation-timing / $total-items-count * $itemcount) infinite;
          }
      }


      div[class*="sh"] {
          border: 1px solid $gray;
          background: transparentize($red, 0.2);
      }

      @for $i from 1 through 6 {
          div[class*="sh"]:nth-child(#{$i}) {
              @if $i < 5 {
                  @include centerLeft($shape-x, $shape-y); // w & h

                  transform:  translateZ($shape-x/2)
                              rotateY($i * 90deg)
                              translateZ($shape-x / 2);

                  -webkit-transform:  translateZ($shape-x/2)
                              rotateY($i * 90deg)
                              translateZ($shape-x / 2);
              } @else {
                  @include centerLeft($shape-x, $shape-x); // w & h
                  $z-distance: $shape-y / 2;
                  @if $i == 6 {
                      $z-distance: -$shape-y / 2;
                  }

                  transform:  translateZ($shape-x/2)
                              rotateX(90deg)
                              translateZ($z-distance);
                  -webkit-transform:  translateZ($shape-x/2)
                              rotateX(90deg)
                              translateZ($z-distance);
              }
          }
      }
  }


  .reverse {
      .shape {
          animation-direction: reverse;
          transform-origin: left center;

          -webkit-animation-direction: reverse;
          -webkit-transform-origin: left center;

          div[class*="sh"] {
              left: auto;
              right: 0;
              background: transparentize(#000, 0.2);
          }
      }
  }
}




@keyframes spiral {
    0% {
        opacity: 0;
        transform: rotateY(0deg)
                    rotateX(-20deg)
                    translateY(-100%);
    }
    50% {
        opacity: 1;
    }
    100% {
        opacity: 0;
        transform: rotateY(180deg)
                    rotateX(20deg)
                    translateY(100%);
    }
}


@keyframes spinY {
    0% {
        transform: rotateY(0deg);
    }
    100% {
        transform: rotateY(360deg);
    }
}







@-webkit-keyframes spiral {
    0% {
        opacity: 0;
        -webkit-transform: rotateY(0deg)
                    rotateX(-20deg)
                    translateY(-100%);
    }
    50% {
        opacity: 1;
    }
    100% {
        opacity: 0;
        -webkit-transform: rotateY(180deg)
                    rotateX(20deg)
                    translateY(100%);
    }
}


@-webkit-keyframes spinY {
    0% {
        -webkit-transform: rotateY(0deg);
    }
    100% {
        -webkit-transform: rotateY(360deg);
    }
}
