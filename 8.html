<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css({.tmp,app}) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
  </head>
  <body>

    <!-- Add your site or application content here -->
    <div class="app-container">
<header class="inner">
  <p class="title">Math driven CSS</p>
  <h1 id="logo"><a href="/">R/GA</a></h1>
</header>

<div id="primary">




  <h1 class="heading1"><strong>Connected Technologies</strong></h1>
  <h2 class="heading2"></h2>

  <div class="module leap-demo">
    <div id="scene-holder">

      <h2 class="thankyou">THANK YOU!</h2> <!-- ng-class="{ active: spinActive }" -->
      <h2 class="username">Mihnea Belcin</h2> <!-- ng-class="{ active: spinActive }" -->
      <div id="scene" class="threed">

        <div class="spin-x">  <!-- ng-class="{ active: spinActive }" -->
          <div class="rotatable-holder">  <!-- {{ activeStep }} -->
            <div id="lcube" class="lcube rotatable-lcube">
                <div class="lcube-half"></div>
            </div>
          </div>
        </div>

        <div id="finger" class="lcube finger">
            <div class="lcube-half finger-half"></div>
        </div>

        <div id="palm" class="lcube palm">
            <div class="lcube-half palm-half"></div>
        </div>
      </div>

    </div>
  </div>







  <ul class="app-nav">
    <li><a href="1.html">chapter 1</a></li>
    <li><a href="2.html">chapter 2</a></li>
    <li><a href="3.html">chapter 3</a></li>
    <li><a href="4.html">chapter 4</a></li>
    <li><a href="5.html">chapter 5</a></li>
    <li><a href="6.html">chapter 6</a></li>
    <li><a href="7.html">chapter 7</a></li>
    <li><a href="8.html" class="selected">chapter 8</a></li>
  </ul>
</div>



    </div>

    <footer>
      <p class="copy">&copy; Mihnea Belcin 2014</p>
    </footer>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="scripts/leap-0.5.0.min.js"></script>
    
    <script>
    
    function initLeap() {
      function moveFinger(Finger, posX, posY, posZ, dirX, dirY, dirZ) {
        Finger.style.webkitTransform =
        Finger.style.mozTransform =
        Finger.style.transform = 'translateX('+posX+'px)'+
                                'translateY('+posY+'px)'+
                                'translateZ('+posZ+'px)'+
                                'rotateX('+dirX+'deg)'+
                                'rotateY('+dirY+'deg)'+
                                'rotateZ('+dirZ+'deg)'+
                                'rotate(90deg) ';
        Finger.style.display = 'block';
      }

      function movePalm(Palm, posX, posY, posZ, rotX, rotY, rotZ) {
        Palm.style.webkitTransform =
        Palm.style.mozTransform =
        Palm.style.transform = 'translateX('+posX+'px)'+
                                'translateY('+posY+'px)'+
                                'translateZ('+posZ+'px)'+
                                'rotateX('+rotX+'deg)'+
                                'rotateY('+rotY+'deg)'+
                                'rotateZ('+rotZ+'deg)'+
                                'rotateY(90deg) rotate(45deg) translateX(50px)';
        Palm.style.display = 'block';
      }

      // $scope.spinActive = false;
      function triggerAnim() {

        if (animStepNr < 2){
          animStepNr++;
          // $scope.activeStep = 'step' + animStepNr;
        } else {
          // $scope.spinActive = true;
        }

        // if (animStepNr === 1) {
        //   $('.rotatable-holder').addClass('step1');
        // }

        if (animStepNr === 1) {
          $('.rotatable-holder').addClass('step2');
        }

        if (animStepNr === 2) {
          $('.spin-x').addClass('active');
          $('.thankyou').addClass('active');
          $('.username').addClass('active');
        }

        // $scope.activeStep = 'step' + animStepNr;
        // $scope.$apply();

        // console.log($scope.activeStep);
      }

      var fingers = {},
          palms = {};

      var gestureStarted = false,
          gestureEnded = false,
          animStepNr = 0;
      Leap.loop(function(frame) {
        var fingerIds = {},
            handIds = {},
            handsLength;

        if (frame.hands === undefined ) {
          handsLength = 0;
        } else {
          handsLength = frame.hands.length;
        }

        for (var handId = 0, handCount = handsLength; handId !== handCount; handId++) {
          var hand = frame.hands[handId],
              posX = (hand.palmPosition[0]*3),
              posY = (hand.palmPosition[2]*3)-200,
              posZ = (hand.palmPosition[1]*3)-400,
              rotX = (hand._rotation[2]*90),
              rotY = (hand._rotation[1]*90),
              rotZ = (hand._rotation[0]*90),
              palm = palms[hand.id];

            // console.log(posZ);

          if (posZ < 150) {
            gestureStarted = true;
          }

          if ( gestureStarted && posZ > 300) {
            gestureEnded = true;
            gestureStarted = false;

            triggerAnim();
          }

          var palmDiv;

          if (!palm) {
            palmDiv = document.getElementById('palm').cloneNode(true);
            palmDiv.setAttribute('id',hand.id);
            // palmDiv.style.backgroundColor='#'+Math.floor(Math.random()*16777215).toString(16);
            document.getElementById('scene').appendChild(palmDiv);
            palms[hand.id] = hand.id;

          } else {
            palmDiv =  document.getElementById(hand.id);

            if (typeof(palmDiv) !== 'undefined' && palmDiv !== null) {
              movePalm(palmDiv, posX, posY, posZ, rotX, rotY, rotZ);
            }
          }

          handIds[hand.id] = true;
        }

        for (handId in palms) {
          if (!handIds[handId]) {
            var palmsDiv =  document.getElementById(palms[handId]);

            palmsDiv.parentNode.removeChild(palmsDiv);

            delete palms[handId];
          }
        }

        for (var pointableId = 0, pointableCount = frame.pointables.length; pointableId !== pointableCount; pointableId++) {
          var pointable = frame.pointables[pointableId],
              pointablePosX = (pointable.tipPosition[0]*3),
              pointablePosY = (pointable.tipPosition[2]*3)-200,
              pointablePosZ = (pointable.tipPosition[1]*3)-400,
              pointableDirX = -(pointable.direction[1]*90),
              pointableDirY = -(pointable.direction[2]*90),
              pointableDirZ = (pointable.direction[0]*90),
              finger = fingers[pointable.id];

          var fingerDiv;
          if (!finger) {
            fingerDiv = document.getElementById('finger').cloneNode(true);
            fingerDiv.setAttribute('id',pointable.id);

            // fingerDiv.style.backgroundColor='#'+Math.floor(Math.random()*16777215).toString(16);

            document.getElementById('scene').appendChild(fingerDiv);
            fingers[pointable.id] = pointable.id;
          } else {
            fingerDiv =  document.getElementById(pointable.id);

            if (typeof(fingerDiv) !== 'undefined' && fingerDiv !== null) {
              moveFinger(fingerDiv, pointablePosX, pointablePosY, pointablePosZ, pointableDirX, pointableDirY, pointableDirZ);
            }
          }

          fingerIds[pointable.id] = true;
        }

        for (var fingerId in fingers) {
          if (!fingerIds[fingerId]) {
            var fingersDiv =  document.getElementById(fingers[fingerId]);
            fingersDiv.parentNode.removeChild(fingersDiv);
            delete fingers[fingerId];
          }
        }

      });

    }

    initLeap();

    </script>

</body>
</html>
